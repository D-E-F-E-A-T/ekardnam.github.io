<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>ekardnam - Luca Bertozzi</title>

	<link href="../css/bootstrap.min.css" rel="stylesheet">
    	<!--[if lt IE 9]>
     		<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      	<![endif]-->

      	<link href="../css/my.css" rel="stylesheet" >
      	<link href="../css/code.css" rel="stylesheet" >
</head>
      <body class="grey" >
      	<div class="jumbotron green white-border" >
      		<div class="container">
      			<img class="img-circle logo" src="../logo.jpg"/>
      			<h1 id="animate" class="nick" ><span style="display: none;" >A</span></h1>
      			<h2 class="fade-in left name" >Luca Bertozzi</h2>
      		</div>
      	</div>

      	<div class="container" >

      		<h1>Researching SKIDROW crack for malware</h1>
      		<h3>by  ekardnam on 09-06-2019</h3>
      		<br/>
      		<a href="../index.html" >Back</a>
      		<br/><br/>

      		<p>I was willing to play some videogames on my computer, but at the same time I was quite annoyed of paying for them. I thought I could take this occasion to analyze some cracked videogames for malware.</p>
<p>I downloaded a torrent for Assassin's Creed II and got an ISO image. I decided to mount it and upload the executables contained in it on VirusTotal and watch the reports.
Here the executables and DLLs I found</p>
<pre class="codehilite"><code>ekardnam@bakunin:~/Downloads/Assassins.Creed.II-SKIDROW/mountpoint$ find . | grep .exe
./SKIDROW/SKIDROW.exe
./Support/DirectX/DXSETUP.exe
./Support/GameLauncher/UbisoftGameLauncherInstaller.exe
./Support/VCRedist/vcredist_x86.exe
./UPDATE/assassins_creed_2_1.01_us.exe
./autorun.exe
./setup.exe
ekardnam@bakunin:~/Downloads/Assassins.Creed.II-SKIDROW/mountpoint$ find . | grep .dll
./ISSetup.dll
./SKIDROW/ubiorbitapi_r2.dll
./Support/DirectX/DSETUP.dll
./Support/DirectX/dsetup32.dll
./Support/DirectX/dxdllreg_x86.cab
./\_Setup.dll</code></pre>


<p>I actually focused on SKIDROW.exe and ubiorbitapi_r2.dll, both these were marked by VirusTotal.</p>
<p><img alt="SKIDROW.exe report" src="/images/skidrow.png" /></p>
<p><img alt="DLL report" src="/images/dll.png" /></p>
<p>Opening SKIDROW.exe in ghidra I found the following imported functions from kernel32.DLL</p>
<p><img alt="SKIROW.exe imports GetProcAddress and LoadLibraryA" src="/images/skidrow-imports.png" /></p>
<p>I thought it would load the ubiorbitapi_r2.dll and run some procedures from it, but the code wasn't so pretty to read and I thought I would go for dynamic analysis.</p>
<p>At the same time I was setting up a VM with the Flare-ON installer I saw in one of LiveOverflow's videos.</p>
<p><img alt="" src="/images/flare-on-vm.png" /></p>
<p>Also the DLL seemed obfuscated at first glance and anyway I'm lazy and dynamic analysis seemed the faster way.</p>
<p>Anyway after some DuckDuckGo-ing I found that the ubiorbitapi_r2.dll is supposed to be a Ubisoft dll for checking the game activation key. This explains why it was found in the cracked files folder. Here some functions it exports:</p>
<pre class="codehilite"><code>0009BD7E  ?ClaimCdKey@OrbitSession@orbitdll@mg@@QAEXIPAVIClaimCdKeyListener@23@PADI@Z
0009BDCA  ?Close@SavegameReader@orbitdll@mg@@QAEXXZ
0009BDF4  ?Close@SavegameWriter@orbitdll@mg@@QAEX_N@Z
0009BE20  ?CreateAccount@OrbitSession@orbitdll@mg@@QAEXIPAVICreateAccountListener@23@PAD1PAG11EEG_N3@Z
0009BE7D  ?GetGeoIpCountry@OrbitSession@orbitdll@mg@@QAEXIPAVIGetGeoIpCountryListener@23@@Z
0009BECF  ?GetLocText@OrbitSession@orbitdll@mg@@QAEPBGPBGPBD@Z
0009BF04  ?GetLoginDetails@OrbitSession@orbitdll@mg@@QAEXIPAVIGetLoginDetailsListener@23@@Z
0009BF56  ?GetName@SavegameInfo@orbitdll@mg@@QAEPBGXZ
0009BF82  ?GetNetworkTraffic@OrbitSession@orbitdll@mg@@QAEXIPAVIGetNetworkTrafficListener@23@@Z
0009BFD8  ?GetOrbitServer@OrbitSession@orbitdll@mg@@QAEXIPAVIGetOrbitServerListener@23@II@Z
0009C02A  ?GetProductId@SavegameInfo@orbitdll@mg@@QAEIXZ
0009C059  ?GetProxyIfNeeded@Proxy@orbitdll@mg@@QAE_NPBDGAAV?$StaticString@$0BAAA@@common@3@@Z
0009C0AD  ?GetRequestUniqueId@OrbitSession@orbitdll@mg@@QAEIXZ
0009C0E2  ?GetSavegameId@SavegameInfo@orbitdll@mg@@QAEIXZ
0009C112  ?GetSavegameList@OrbitSession@orbitdll@mg@@QAEXIPAVIGetSavegameListListener@23@I@Z
0009C165  ?GetSavegameReader@OrbitSession@orbitdll@mg@@QAEXIPAVIGetSavegameReaderListener@23@II@Z
0009C1BD  ?GetSavegameWriter@OrbitSession@orbitdll@mg@@QAEXIPAVIGetSavegameWriterListener@23@II_N@Z
0009C217  ?GetSize@SavegameInfo@orbitdll@mg@@QAEIXZ
0009C241  ?GetTos@OrbitSession@orbitdll@mg@@QAEXIPAVIGetTosListener@23@PBD1@Z
0009C285  ?IsSavegamesInSync@Proxy@orbitdll@mg@@QAE_NXZ
0009C2B3  ?IsVersionBanned@OrbitSession@orbitdll@mg@@QAEXIPAVIIsVersionBannedListener@23@II@Z
0009C307  ?LogIn@OrbitSession@orbitdll@mg@@QAEXIPAVILogInListener@23@PADPAG@Z
0009C34B  ?LogOut@OrbitSession@orbitdll@mg@@QAEXIPAVILogOutListener@23@@Z
0009C38B  ?OwnsProduct@OrbitSession@orbitdll@mg@@QAEXIPAVIOwnsProductListener@23@I@Z
0009C3D6  ?Read@SavegameReader@orbitdll@mg@@QAEXIPAVISavegameReadListener@23@IPAXI@Z
0009C421  ?RemoveSavegame@OrbitSession@orbitdll@mg@@QAEXIPAVIRemoveSavegameListener@23@II@Z
0009C473  ?SetCookie@Proxy@orbitdll@mg@@QAEXI@Z
0009C499  ?SetName@SavegameWriter@orbitdll@mg@@QAE_NPAG@Z
0009C4C9  ?SetSavegameSyncCallback@Proxy@orbitdll@mg@@QAEXPAVISavegameSyncCallback@23@@Z
0009C518  ?SetStaticProxy@Proxy@orbitdll@mg@@QAEXPBD@Z
0009C545  ?SetUseOnlineSave@Proxy@orbitdll@mg@@QAEX_N@Z
0009C573  ?Start@Proxy@orbitdll@mg@@QAE_NXZ
0009C595  ?StartLauncher@OrbitSession@orbitdll@mg@@QAE_NIIPBD0@Z
0009C5CC  ?StartProcessingSavegameSyncTasks@Proxy@orbitdll@mg@@QAEXXZ
0009C608  ?StartSavegameSync@Proxy@orbitdll@mg@@QAEXW4TestMode@SavegameStorage@23@PAVITestStatusCallback@523@@Z
0009C66E  ?StopSavegameSync@Proxy@orbitdll@mg@@QAEXXZ
0009C69A  ?Update@OrbitSession@orbitdll@mg@@QAEXXZ
0009C6C3  ?ValidateLauncherCookie@OrbitSession@orbitdll@mg@@QAEXIPAVIValidateLauncherCookieListener@23@I@Z
0009C724  ?ValidateUsername@OrbitSession@orbitdll@mg@@QAEXIPAVIValidateUsernameListener@23@PAD@Z
0009C77B  ?Write@SavegameWriter@orbitdll@mg@@QAEXIPAVISavegameWriteListener@23@PAXI@Z

0009C7C7  MgOrbitdllGetFakeSession
0009C7E0  MgOrbitdllGetLocText
0009C7F5  MgOrbitdllGetLoginDetails
0009C80F  MgOrbitdllGetNetworkTraffic
0009C82B  MgOrbitdllGetOrbitServer
0009C844  MgOrbitdllGetRequestUniqueId
0009C861  MgOrbitdllGetSavegameList
0009C87B  MgOrbitdllGetSavegameReader
0009C897  MgOrbitdllGetSavegameWriter
0009C8B3  MgOrbitdllGetSession
0009C8C8  MgOrbitdllRemoveSavegame
0009C8E1  MgOrbitdllSaveGameInfoGetName
0009C8FF  MgOrbitdllSaveGameInfoGetProductId
0009C922  MgOrbitdllSaveGameInfoGetSavegameId
0009C946  MgOrbitdllSaveGameInfoGetSize
0009C964  MgOrbitdllSaveGameReaderClose
0009C982  MgOrbitdllSaveGameReaderRead
0009C99F  MgOrbitdllSaveGameWriterClose
0009C9BD  MgOrbitdllSaveGameWriterSetName
0009C9DD  MgOrbitdllSaveGameWriterWrite
0009C9FB  MgOrbitdllStartLauncher
0009CA13  MgOrbitdllUpdate</code></pre>


<p>I decided to install the game to get also the original DLL and see what's different.</p>
<p><img alt="Installation process" src="/images/acii-install.png" /></p>
<p>Strings of the original DLL were completely different obviously, but seems all pretty normal as the DLL is cracked.</p>
<p>After going with some dynamic analysis on the SKIDROW.exe binary I understood that my initial thought that it would load procedures from the ubiorbit DLL was wrong. ALso, given the DLL purpose it makes sense that it is not loading procedures from there.
By setting a breakpoint at GetProcAddress and watching the stack I could see which procedures it is loading that are not marked as imported in the PE file.</p>
<p><img alt="" src="/images/skidrowdbg-1.png" /></p>
<p>I used procmon to monitor the calls the executable made ton the Win API and I did not get anything that to my non-expert eye looked suspicious</p>
<p><img alt="" src="/images/skidrow-procmon.png" /></p>
<p>Finally I looked at what was happening in the network. And here it was doing really nothing.
Also this is what it happens after you execute this binary.</p>
<p><img alt="" src="/images/skidrow-run.png" /></p>
<p>It just seems a "signature" by this team of crackers called Skid Row, hance as it does not seem to be downloading other payloads, I don't think it hides any particular malware.</p>
<p>Now there is still the DLL to analyze, but that would be for another post!</p>

      		<div class="row slide-in" >
      			<div class="col-md-4" ></div>
      			<div class="col-md-4" style="text-align: center;" >
      				<a href="https://github.com/ekardnam" class="btn btn-default" ><span class="glyphicon glyphicon-menu-right" ></span> GitHub</a>
      				<a href="https://twitter.com/ekardnam_" class="btn btn-default" ><span class="glyphicon glyphicon-menu-right" ></span> Twitter</a>
      				<a href="https://t.me/ekardnam" class="btn btn-default" ><span class="glyphicon glyphicon-menu-right" ></span> Telegram</a>
      				<a href="http://pool.sks-keyservers.net/pks/lookup?op=get&search=0x4C087AD5174FBD8B" ><span class="glyphicon glyphicon-menu-right" ></span> PGP</a>
      			</div>
      		</div>
      		<hr />
      		<footer>
      			<p>&copy; 2018 Luca Bertozzi</p>
      		</footer>
      	</div> 

            <script type="text/x-mathjax-config">
                  MathJax.Hub.Config({
                  config: ["MMLorHTML.js"],
                  jax: ["input/TeX", "output/HTML-CSS", "output/NativeMML"],
                  extensions: ["MathMenu.js", "MathZoom.js"]
            });
            </script>

            <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js"></script>

      	<script>
			//animation code
			var write = "ekardnam's blog";
			var h1 = document.getElementById("animate");
			var i = 0;
			var b = true;
			var animation = function() {
				if (i <= write.length) {
					h1.innerHTML = write.substring(0, i) + "_";
					i++;
					window.setTimeout(animation, 200);
				} else {
					if (b) {
						h1.innerHTML = write + "_";
					} else {
						h1.innerHTML = write;
					}
					b = !b;
					window.setTimeout(animation, 500)
				}
			}
			animation();
		</script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
		<script src="../js/bootstrap.min.js"></script>
	</body>
	</html>